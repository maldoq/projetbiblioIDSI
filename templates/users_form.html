{% extends 'base.html' %}

{% if user %}
    {% url 'users_edit' user.matricule as form_url %}
{% else %}
    {% url 'users_form' as form_url %}
{% endif %}

{% block title %}{% if user %}Modifier{% else %}Ajouter{% endif %} un utilisateur - Bibliothèque{% endblock %}
{% block page_title %}{% if user %}Modifier{% else %}Ajouter{% endif %} un utilisateur{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3>
            <i class="fas fa-user-{% if user %}edit{% else %}plus{% endif %}"></i>
            {% if user %}Modifier l'utilisateur{% else %}Nouvel utilisateur{% endif %}
        </h3>
        <a href="{% url 'users_list' %}" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left"></i>
            Retour à la liste
        </a>
    </div>
    <div class="card-body">
        <form method="post" action="{{ form_url }}">
            {% csrf_token %}
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <!-- Colonne gauche -->
                <div>
                    <div class="form-group">
                        <label for="nom">
                            Nom <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="nom" 
                            name="nom" 
                            value="{{ user.nom }}"
                            placeholder="Ex: Marie"
                            required
                        >
                        {% if form.nom.errors %}
                        <span class="form-error">{{ form.nom.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="prenoms">
                            Prénoms <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="prenoms" 
                            name="prenoms" 
                            value="{{ user.prenoms }}"
                            placeholder="Ex: Dupont"
                            required
                        >
                        {% if form.prenoms.errors %}
                        <span class="form-error">{{ form.prenoms.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="emailInst">
                            Email institutionnel <span class="required">*</span>
                        </label>
                        <input 
                            type="email" 
                            id="emailInst" 
                            name="emailInst" 
                            value="{{ user.emailInst }}"
                            placeholder="Ex: marie.dupont@ecole.fr"
                            required
                        >
                        {% if form.emailInst.errors %}
                        <span class="form-error">{{ form.emailInst.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="emailPers">
                            Email personnel
                        </label>
                        <input 
                            type="email" 
                            id="emailPers" 
                            name="emailPers" 
                            value="{{ user.emailPers }}"
                            placeholder="Ex: marie.dupont@ecole.fr"
                            required
                        >
                        {% if form.emailPers.errors %}
                        <span class="form-error">{{ form.emailPers.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="telephone">
                            Téléphone
                        </label>
                        <input 
                            type="text" 
                            id="telephone" 
                            name="telephone" 
                            value="{{ user.telephone }}"
                            placeholder="Ex: +225 01 02 03 04 05"
                        >
                        <span class="form-help">Format: +225 XX XX XX XX XX</span>
                    </div>
                </div>

                <!-- Colonne droite -->
                <div>
                    <div class="form-group">
                        <label for="ecole">
                            Ecole <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="ecole" 
                            name="ecole" 
                            value="{{ user.ecole.nom }}"
                            placeholder="ex: IDSI"
                        >
                        <span class="form-help">Mettre l'abrégé comme IDSI, ESI</span>
                    </div>

                    <div class="form-group">
                        <label for="matricule">
                            Matricule d'étudiant <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="matricule" 
                            name="matricule" 
                            value="{{ user.matricule }}"
                            placeholder="Ex: 20INP01221"
                            required
                        >
                        <span class="form-help">Matricule de l'étudiant</span>
                    </div>

                    <div class="form-group">
                        <label for="dateNaiss">
                            Date de naissance
                        </label>
                        <input 
                            type="date" 
                            id="dateNaiss" 
                            name="dateNaiss" 
                            value="{{ user.dateNaiss|date:'Y-m-d' }}"
                        >
                    </div>

                    <div class="form-group">
                        <label for="numChambre">
                            Numéro de chambre
                        </label>
                        <textarea 
                            id="numChambre" 
                            name="numChambre" 
                            placeholder="Ex: G03"
                            rows="3"
                        >{{ user.numChambre }}</textarea>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input 
                                type="checkbox" 
                                name="is_active" 
                                {% if user.is_active or not user %}checked{% endif %}
                            >
                            <span>Compte actif</span>
                        </label>
                        <span class="form-help">L'utilisateur peut emprunter des livres</span>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="btn-group" style="margin-top: 24px; justify-content: flex-end;">
                <a href="{% url 'users_list' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    Annuler
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    {% if user %}Mettre à jour{% else %}Enregistrer{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}